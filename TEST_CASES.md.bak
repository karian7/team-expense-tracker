# 팀 회식비 관리 서비스 - 테스트 케이스

## 테스트 환경 설정

### 사전 준비

1. OpenAI API Key 설정 (`backend/.env` 파일)
2. 백엔드 서버 실행: `cd backend && npm run dev`
3. 프론트엔드 서버 실행: `cd frontend && npm run dev`
4. 브라우저에서 http://localhost:5173 접속

---

## 1. 초기 설정 테스트

### TC-001: 초기 예산 설정

**목적**: 서비스 최초 사용 시 초기 예산 설정

**사전 조건**:

- 데이터베이스에 데이터가 없는 상태 (또는 초기화 필요)

**테스트 단계**:

1. 메인 페이지 접속
2. 설정 아이콘(⚙️) 클릭
3. "초기 예산 설정" 섹션에서 금액 입력 (예: 1,000,000원)
4. "🚨 모든 데이터 삭제 및 초기 예산 설정" 버튼 클릭
5. 경고 메시지 확인 후 "확인" 클릭 (2회)

**예상 결과**:

- ✅ "초기 예산이 설정되었습니다" 알림 표시
- ✅ 모든 이전 데이터 삭제 확인
- ✅ 설정 페이지에서 initialBudget 값 확인
- ✅ 메인 페이지에서 예산 0원 표시 (아직 이번 달 예산이 생성되지 않음)

---

## 2. 월별 예산 관리 테스트

### TC-002: 기본 월별 예산 설정

**목적**: 매월 자동 생성되는 기본 예산 금액 설정

**테스트 단계**:

1. 설정 페이지 열기
2. "월별 기본 회식비 설정" 섹션에서 금액 입력 (예: 500,000원)
3. "설정 저장" 버튼 클릭

**예상 결과**:

- ✅ "설정이 저장되었습니다" 알림 표시
- ✅ 설정이 DB에 저장되었는지 확인

### TC-002-1: 예산 설정 시 현재 월 자동 반영 (Regression)

**목적**: 예산 설정 변경 시 현재 달에 0원 예산 이벤트가 있으면 자동으로 업데이트

**배경**:

- 버그: 예산을 설정해도 이미 생성된 0원 예산 이벤트가 업데이트되지 않아 메인 페이지에 반영되지 않음
- 수정: `setDefaultMonthlyBudget()` 백엔드 로직에서 0원 이벤트 감지 시 자동으로 새 이벤트 생성

**사전 조건**:

- 데이터베이스 초기화 또는 현재 달에 0원 예산 이벤트가 있는 상태

**테스트 단계**:

1. 백엔드 이벤트 확인: `curl -s "http://localhost:3001/api/events/month/{year}/{month}"`
2. 현재 달에 amount=0인 "기본 월별 예산" 이벤트가 있는지 확인
3. 설정 페이지 열기
4. "현재 월 예산" 변경 버튼 클릭
5. 500,000원 입력 후 저장
6. "예산이 변경되었습니다" 알림 확인
7. 설정 페이지 닫기
8. 메인 페이지에서 예산 확인

**예상 결과**:

- ✅ 백엔드에 새 이벤트 생성됨:
  - eventType: "BUDGET_IN"
  - amount: 500000
  - description: "기본 월별 예산 (설정 변경)"
- ✅ 메인 페이지에 "이번 달 남은 예산: ₩500,000원" 표시
- ✅ 설정 페이지에서 "이번달 남은 예산: ₩500,000원" 표시

**백엔드 확인**:

```bash
curl -s "http://localhost:3001/api/events/month/$(date +%Y)/$(date +%-m)" | jq '.data | map({sequence, eventType, amount, description})'
```

### TC-002-2: 예산 조정 기능 (Regression)

**목적**: 설정 페이지에서 이번 달 예산을 수동으로 조정

**배경**:

- 버그: `useAdjustCurrentBudget()` 훅이 빈 함수로 구현되어 조정 기능이 작동하지 않음
- 수정: 백엔드 API 호출 및 동기화 로직 구현, SettingsPage에서 파라미터 전달

**사전 조건**:

- TC-002-1 완료 (현재 달 예산이 500,000원)

**테스트 단계**:

1. 설정 페이지 열기
2. "이번달 남은 예산" 확인 (₩500,000원)
3. "조정" 버튼 클릭
4. 목표 잔액: 700,000원 입력
5. 조정 내용: "추가 예산 지원" 입력
6. "조정" 버튼 클릭
7. "이번달 예산이 조정되었습니다" 알림 확인
8. 설정 페이지 닫기
9. 메인 페이지에서 예산 확인

**예상 결과**:

- ✅ 백엔드에 조정 이벤트 생성됨:
  - eventType: "BUDGET_IN"
  - amount: 200000 (700,000 - 500,000)
  - description: "추가 예산 지원"
- ✅ 메인 페이지에 "이번 달 남은 예산: ₩700,000원" 표시
- ✅ 총 예산: ₩700,000원 표시

**백엔드 확인**:

```bash
# 이벤트 목록 확인
curl -s "http://localhost:3001/api/events/month/$(date +%Y)/$(date +%-m)" | jq '.data | map({sequence, eventType, amount, description})'

# 현재 월 예산 확인
curl -s "http://localhost:3001/api/monthly-budgets/current" | jq '.data | {totalBudget, balance}'
```

**주의사항**:

- 조정은 목표 잔액에서 현재 잔액을 뺀 차액만큼 이벤트를 생성합니다
- 음수 조정도 가능합니다 (예: 500,000원 → 300,000원 = -200,000원 이벤트)

### TC-003: 현재 월 예산 자동 생성

**목적**: 현재 달에 예산이 없을 때 자동으로 생성되는지 확인

**테스트 단계**:

1. 기본 월별 예산 설정 (TC-002 완료)
2. 메인 페이지로 이동

**예상 결과**:

- ✅ 현재 달 예산이 자동 생성됨
- ✅ baseAmount = 설정한 기본 예산
- ✅ carriedAmount = 0 (첫 달)
- ✅ totalBudget = baseAmount
- ✅ balance = totalBudget

### TC-004: 월 이월 확인

**목적**: 이전 달 잔액이 다음 달로 자동 이월되는지 확인

**테스트 단계**:

1. 현재 달에 사용 내역 추가 (잔액이 남도록)
2. 시스템 날짜를 다음 달로 변경하거나 수동으로 다음 달 예산 생성
3. 다음 달 예산 조회

**예상 결과**:

- ✅ 새 달 예산의 carriedAmount = 이전 달 balance
- ✅ totalBudget = baseAmount + carriedAmount
- ✅ balance = totalBudget (아직 사용 내역 없음)

---

## 3. 영수증 업로드 및 OCR 테스트

### TC-005: 영수증 업로드 (카메라)

**목적**: iOS/Android에서 카메라로 영수증 촬영 및 업로드

**사전 조건**: 모바일 기기 또는 Chrome DevTools 모바일 모드

**테스트 단계**:

1. "영수증 추가하기" 버튼 클릭
2. 카메라 아이콘 클릭 또는 파일 선택
3. 영수증 촬영 또는 선택
4. 업로드 대기

**예상 결과**:

- ✅ 이미지 미리보기 표시
- ✅ "영수증 분석 중..." 로딩 표시
- ✅ OCR 분석 완료 후 결과 표시

### TC-006: OCR 결과 자동 인식

**목적**: OpenAI Vision API가 영수증 정보를 정확히 추출하는지 확인

**테스트 단계**:

1. 명확한 영수증 이미지 업로드 (금액, 날짜, 상호명이 뚜렷한 것)
2. OCR 결과 확인

**예상 결과**:

- ✅ 금액이 정확히 인식됨
- ✅ 날짜가 YYYY-MM-DD 형식으로 인식됨
- ✅ 상호명이 인식됨
- ✅ confidence 값이 0.7 이상 (높은 신뢰도)

### TC-007: OCR 결과 수동 수정

**목적**: OCR 인식이 잘못되었을 때 사용자가 수정 가능한지 확인

**테스트 단계**:

1. 영수증 업로드 후 OCR 결과 확인
2. 잘못 인식된 필드 수정 (예: 금액 50000 → 55000)
3. 작성자 이름 입력
4. "저장" 버튼 클릭

**예상 결과**:

- ✅ 수정된 값이 저장됨
- ✅ 사용 내역 목록에 표시됨
- ✅ 잔액이 자동으로 재계산됨

### TC-008: OCR 실패 시 수동 입력

**목적**: OCR이 실패해도 수동으로 입력 가능한지 확인

**테스트 단계**:

1. 흐릿하거나 읽기 어려운 영수증 업로드
2. OCR 실패 또는 낮은 신뢰도 결과
3. 모든 필드를 수동으로 입력
4. "저장" 버튼 클릭

**예상 결과**:

- ✅ 수동 입력한 값으로 저장됨
- ✅ 정상적으로 사용 내역 생성됨

---

## 4. 사용 내역 관리 테스트

### TC-009: 사용 내역 추가

**목적**: 정상적으로 사용 내역이 추가되는지 확인

**테스트 단계**:

1. TC-007 또는 TC-008 완료
2. 메인 페이지에서 사용 내역 목록 확인

**예상 결과**:

- ✅ 추가한 사용 내역이 목록에 표시됨
- ✅ 작성자, 금액, 날짜, 상호명 정보 표시
- ✅ 잔액이 감소됨 (totalSpent 증가)

### TC-010: 사용 내역 상세보기

**목적**: 사용 내역 클릭 시 상세 정보 표시

**테스트 단계**:

1. 사용 내역 목록에서 항목 클릭
2. 모달에서 상세 정보 확인

**예상 결과**:

- ✅ 영수증 이미지 표시
- ✅ 작성자, 금액, 날짜, 상호명 표시
- ✅ "닫기" 버튼으로 모달 닫기 가능

### TC-011: 사용 내역 삭제

**목적**: 사용 내역 삭제 시 잔액이 자동으로 업데이트되는지 확인

**사전 조건**: 최소 1개의 사용 내역 존재

**테스트 단계**:

1. 사용 내역 항목의 삭제 아이콘(🗑️) 클릭
2. 확인 메시지에서 "확인" 클릭
3. 잔액 변경 확인

**예상 결과**:

- ✅ 사용 내역이 목록에서 제거됨
- ✅ 잔액이 자동으로 증가함
- ✅ totalSpent가 감소함

### TC-012: 작성자별 필터링

**목적**: 작성자 이름으로 필터링 가능한지 확인

**사전 조건**: 여러 작성자의 사용 내역 존재

**테스트 단계**:

1. 사용 내역 목록 상단의 작성자 필터 드롭다운 클릭
2. 특정 작성자 선택

**예상 결과**:

- ✅ 선택한 작성자의 내역만 표시됨
- ✅ "전체" 선택 시 모든 내역 표시됨

---

## 5. CSV Export/Import 테스트

### TC-013: CSV Export (백업)

**목적**: 모든 사용 내역을 CSV로 백업

**사전 조건**: 최소 3개 이상의 사용 내역 존재

**테스트 단계**:

1. 설정 페이지 열기
2. "데이터 백업 (Export)" 섹션에서 "💾 백업 다운로드" 버튼 클릭
3. 다운로드된 CSV 파일 열기

**예상 결과**:

- ✅ CSV 파일이 다운로드됨
- ✅ 파일명: `expenses_YYYY-MM-DD.csv`
- ✅ 헤더: `ID,작성자,금액,사용날짜,상호명`
- ✅ 모든 사용 내역이 포함됨
- ✅ Excel에서 열었을 때 한글이 깨지지 않음 (UTF-8 BOM)

### TC-014: CSV Import (복원) - 새 데이터 추가

**목적**: CSV 파일로 새로운 데이터 추가

**테스트 단계**:

1. 텍스트 에디터로 CSV 파일 생성:

```csv
ID,작성자,금액,사용날짜,상호명
,홍길동,30000,2024-12-01,테스트식당
,김철수,25000,2024-12-02,카페
```

2. 설정 페이지에서 "데이터 복원 (Import)" 섹션으로 이동
3. CSV 파일 선택
4. "📂 데이터 복원" 버튼 클릭

**예상 결과**:

- ✅ "복원 완료" 알림 표시
- ✅ 생성: 2건 표시
- ✅ 업데이트: 0건 표시
- ✅ 새로운 사용 내역이 목록에 추가됨
- ✅ 잔액이 자동으로 재계산됨

### TC-015: CSV Import (복원) - 기존 데이터 업데이트

**목적**: ID가 일치하는 데이터를 업데이트 (upsert)

**사전 조건**: TC-013에서 백업한 CSV 파일

**테스트 단계**:

1. TC-013에서 다운로드한 CSV 파일 열기
2. 기존 데이터의 금액 수정 (예: 50000 → 60000)
3. 설정 페이지에서 CSV 파일 업로드

**예상 결과**:

- ✅ "복원 완료" 알림 표시
- ✅ 생성: 0건 (또는 새 데이터 수)
- ✅ 업데이트: N건 (수정한 데이터 수)
- ✅ 기존 데이터의 금액이 업데이트됨
- ✅ ID는 그대로 유지됨
- ✅ 잔액이 재계산됨

### TC-016: CSV Import - 오류 처리

**목적**: 잘못된 CSV 형식에 대한 오류 처리 확인

**테스트 단계**:

1. 잘못된 형식의 CSV 파일 생성:

```csv
ID,작성자,금액,사용날짜,상호명
,홍길동,잘못된금액,2024-12-01,식당
,김철수,-5000,2024-12-02,카페
```

2. CSV 파일 업로드

**예상 결과**:

- ✅ "복원 완료" 알림에 실패 내역 표시
- ✅ 실패: 2건
- ✅ 오류 메시지 표시 (각 행의 문제 설명)
- ✅ 정상 데이터는 처리됨

### TC-017: CSV 템플릿 다운로드

**목적**: 템플릿 파일로 CSV 형식 확인

**테스트 단계**:

1. 설정 페이지에서 "📄 템플릿 다운로드" 클릭
2. 다운로드된 파일 열기

**예상 결과**:

- ✅ `expense_import_template.csv` 파일 다운로드됨
- ✅ 헤더와 예제 데이터 1줄 포함
- ✅ 올바른 형식 확인

---

## 6. 잔액 계산 테스트

### TC-018: 자동 잔액 계산

**목적**: 사용 내역 추가/삭제/수정 시 잔액 자동 재계산

**테스트 단계**:

1. 현재 잔액 확인 (예: 500,000원)
2. 50,000원 사용 내역 추가
3. 잔액 확인 (450,000원 예상)
4. 해당 내역 삭제
5. 잔액 확인 (500,000원으로 복원)

**예상 결과**:

- ✅ 추가 시: balance -= amount
- ✅ 삭제 시: balance += amount
- ✅ 실시간으로 잔액 업데이트됨

### TC-019: 예산 초과 경고

**목적**: 예산의 90% 이상 사용 시 경고 표시

**테스트 단계**:

1. 총 예산의 91% 이상 사용
2. 메인 페이지 확인

**예상 결과**:

- ✅ 노란색 경고 메시지 표시
- ✅ "⚠️ 예산의 XX%를 사용했습니다" 문구 표시
- ✅ 진행률 바가 노란색 또는 빨간색으로 변경

### TC-020: 예산 초과 상태

**목적**: 예산을 초과한 경우 알림 표시

**테스트 단계**:

1. 총 예산을 초과하는 사용 내역 추가
2. 잔액 확인

**예상 결과**:

- ✅ 잔액이 음수로 표시됨
- ✅ 빨간색으로 강조됨
- ✅ "❗ 예산을 초과했습니다" 경고 표시

---

## 7. UI/UX 테스트

### TC-021: 모바일 반응형 테스트

**목적**: 모바일 기기에서 정상 작동 확인

**테스트 환경**: iOS Safari, Android Chrome

**테스트 단계**:

1. 모바일 브라우저에서 접속
2. 모든 주요 기능 테스트 (TC-005 ~ TC-012)

**예상 결과**:

- ✅ 레이아웃이 모바일에 최적화됨
- ✅ 터치 인터랙션 정상 작동
- ✅ 카메라 직접 접근 가능
- ✅ 폰트 크기 적절 (16px 이상)
- ✅ 버튼 크기 충분 (탭하기 쉬움)

### TC-022: 로딩 상태 표시

**목적**: 비동기 작업 중 로딩 상태 표시

**테스트 단계**:

1. 영수증 업로드 (OCR 처리 중)
2. CSV Import (대량 데이터 처리 중)
3. 설정 저장 중

**예상 결과**:

- ✅ 로딩 스피너 또는 "처리 중..." 메시지 표시
- ✅ 버튼이 비활성화됨
- ✅ 중복 클릭 방지됨

### TC-023: 오류 메시지 표시

**목적**: 오류 발생 시 명확한 메시지 표시

**테스트 단계**:

1. 네트워크 연결 끊기
2. 영수증 업로드 시도
3. 오류 메시지 확인

**예상 결과**:

- ✅ 사용자 친화적인 오류 메시지 표시
- ✅ 해결 방법 제시
- ✅ 에러 세부사항 (개발 환경에서)

---

## 8. 통합 시나리오 테스트

### TC-024: 전체 플로우 테스트

**목적**: 서비스의 전체 사용 흐름 검증

**테스트 시나리오**:

1. **초기 설정**
   - 초기 예산 1,000,000원 설정
   - 기본 월별 예산 500,000원 설정

2. **첫 달 사용**
   - 영수증 3개 업로드 (각 50,000원, 70,000원, 30,000원)
   - 총 사용액: 150,000원
   - 잔액: 350,000원 확인

3. **데이터 백업**
   - CSV Export로 백업 파일 다운로드

4. **두 번째 달 (시뮬레이션)**
   - 수동으로 다음 달 예산 확인
   - 이월 금액 350,000원 확인
   - 총 예산: 850,000원 (500,000 + 350,000)

5. **데이터 수정**
   - 백업 파일에서 금액 수정
   - CSV Import로 복원
   - 변경사항 확인

6. **필터링 및 조회**
   - 작성자별 필터링
   - 사용 내역 상세보기

**예상 결과**:

- ✅ 모든 단계가 순차적으로 정상 작동
- ✅ 데이터 일관성 유지
- ✅ 예산 및 잔액이 정확히 계산됨

---

## 9. 성능 테스트

### TC-025: 대량 데이터 처리

**목적**: 100개 이상의 사용 내역 처리 성능 확인

**테스트 단계**:

1. CSV 파일로 100개의 사용 내역 생성
2. Import 실행
3. 처리 시간 및 UI 반응성 확인

**예상 결과**:

- ✅ 30초 이내에 처리 완료
- ✅ UI가 멈추지 않음
- ✅ 잔액이 정확히 계산됨

### TC-026: OCR 처리 시간

**목적**: 영수증 OCR 처리 시간 확인

**테스트 단계**:

1. 영수증 이미지 5개 연속 업로드
2. 각각의 OCR 처리 시간 측정

**예상 결과**:

- ✅ 평균 5~10초 이내 처리
- ✅ 타임아웃 없음
- ✅ 처리 중 UI 응답성 유지

---

## 10. 보안 및 에러 핸들링 테스트

### TC-027: 파일 업로드 제한

**목적**: 허용되지 않은 파일 형식 차단

**테스트 단계**:

1. PDF, TXT, EXE 등 이미지가 아닌 파일 업로드 시도
2. CSV Import에 이미지 파일 업로드 시도

**예상 결과**:

- ✅ "유효하지 않은 파일 형식" 오류 메시지
- ✅ 업로드 차단됨

### TC-028: 파일 크기 제한

**목적**: 큰 파일 업로드 시 제한 확인

**테스트 단계**:

1. 10MB 이상의 이미지 파일 업로드 시도
2. 5MB 이상의 CSV 파일 업로드 시도

**예상 결과**:

- ✅ "파일 크기 제한 초과" 오류 메시지
- ✅ 업로드 차단됨

### TC-029: SQL Injection 방어

**목적**: SQL Injection 공격 방어 확인

**테스트 단계**:

1. 작성자 이름에 `'; DROP TABLE expenses; --` 입력
2. 저장 시도

**예상 결과**:

- ✅ 정상적으로 저장됨 (Prisma ORM이 자동 방어)
- ✅ 데이터베이스에 영향 없음

### TC-030: XSS 방어

**목적**: XSS 공격 방어 확인

**테스트 단계**:

1. 작성자 이름에 `<script>alert('XSS')</script>` 입력
2. 저장 후 목록에서 확인

**예상 결과**:

- ✅ 스크립트가 실행되지 않음
- ✅ 텍스트로만 표시됨 (React의 자동 이스케이프)

---

## 테스트 체크리스트

### 필수 테스트 (모든 배포 전 수행)

- [ ] TC-001: 초기 예산 설정
- [ ] TC-002: 기본 월별 예산 설정
- [ ] **TC-002-1: 예산 설정 시 현재 월 자동 반영 (Regression)**
- [ ] **TC-002-2: 예산 조정 기능 (Regression)**
- [ ] TC-005: 영수증 업로드
- [ ] TC-007: OCR 결과 수정
- [ ] TC-009: 사용 내역 추가
- [ ] TC-013: CSV Export
- [ ] TC-014: CSV Import (새 데이터)
- [ ] TC-015: CSV Import (업데이트)
- [ ] TC-018: 자동 잔액 계산
- [ ] TC-021: 모바일 반응형
- [ ] TC-024: 전체 플로우

### 권장 테스트 (주요 업데이트 시 수행)

- [ ] TC-003 ~ TC-004: 월 예산 관리
- [ ] TC-006 ~ TC-008: OCR 관련
- [ ] TC-010 ~ TC-012: 사용 내역 관리
- [ ] TC-016 ~ TC-017: CSV 오류 처리
- [ ] TC-019 ~ TC-020: 예산 경고
- [ ] TC-022 ~ TC-023: UI/UX
- [ ] TC-025 ~ TC-026: 성능
- [ ] TC-027 ~ TC-030: 보안

### Regression 테스트 (버그 수정 후 필수)

- [ ] **TC-002-1: 예산 설정 시 현재 월 자동 반영**
  - 수정 일자: 2025-12-07
  - 관련 파일: `backend/src/services/settingsService.ts`, `frontend/src/hooks/useSettings.ts`
  - 증상: 예산 설정해도 메인 페이지에 반영 안됨
- [ ] **TC-002-2: 예산 조정 기능**
  - 수정 일자: 2025-12-07
  - 관련 파일: `frontend/src/hooks/useBudget.ts`, `frontend/src/pages/SettingsPage.tsx`, `frontend/src/services/api.ts`
  - 증상: 조정 버튼 클릭해도 실제 조정되지 않음

---

## 버그 리포트 템플릿

**버그 제목**: [간단한 설명]

**테스트 케이스**: TC-XXX

**재현 단계**:

1.
2.
3.

## **예상 결과**:

## **실제 결과**:

**환경**:

- 브라우저:
- OS:
- 화면 크기:

**스크린샷**:
[스크린샷 첨부]

---

## 테스트 결과 요약

### 테스트 일자: \***\*\_\_\_\*\***

| 카테고리                 | 통과     | 실패 | 건너뜀 |
| ------------------------ | -------- | ---- | ------ |
| 초기 설정 (TC-001~002)   | / 2      |      |        |
| **예산 관리 Regression** | **/ 2**  |      |        |
| 월별 예산 (TC-003~004)   | / 2      |      |        |
| 영수증/OCR (TC-005~008)  | / 4      |      |        |
| 사용 내역 (TC-009~012)   | / 4      |      |        |
| CSV (TC-013~017)         | / 5      |      |        |
| 잔액 계산 (TC-018~020)   | / 3      |      |        |
| UI/UX (TC-021~023)       | / 3      |      |        |
| 통합 (TC-024)            | / 1      |      |        |
| 성능 (TC-025~026)        | / 2      |      |        |
| 보안 (TC-027~030)        | / 4      |      |        |
| **총계**                 | **/ 32** |      |        |

**테스터**: \***\*\_\_\_\*\***
**코멘트**:
