// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model BudgetEvent {
  sequence    Int      @id @default(autoincrement())
  
  // 이벤트 메타데이터
  eventType   String   // "BUDGET_IN" | "EXPENSE" | "EXPENSE_REVERSAL" | "BUDGET_ADJUSTMENT_INCREASE" | "BUDGET_ADJUSTMENT_DECREASE"
  eventDate   DateTime // 실제 발생 날짜
  year        Int      // 집계용 인덱스
  month       Int
  
  // 이벤트 데이터
  authorName  String
  amount      Decimal  // BUDGET_IN: 양수(예산 증가), EXPENSE: 양수(지출)
  storeName   String?
  description String?
  
  // 영수증 (EXPENSE만 해당)
  receiptImage Bytes?
  ocrRawData   String?

  // 관련 이벤트 (예: 삭제된 지출 원본)
  referenceSequence Int?

  // 타임스탬프 (이벤트 기록 시각)
  createdAt   DateTime @default(now())

  @@unique([year, month, eventType, authorName, description])
  @@index([year, month])
  @@index([eventDate])
  @@index([authorName])
  @@index([referenceSequence])
  @@map("budget_events")
}

model Settings {
  id                   String   @id @default(uuid())
  key                  String   @unique // 설정 키 (예: "default_monthly_budget")
  value                String   // 설정 값 (JSON string)
  description          String?  // 설정 설명
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("settings")
}
